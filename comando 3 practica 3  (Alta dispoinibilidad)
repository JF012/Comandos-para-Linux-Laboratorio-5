# Actualiza repositorios en ambas maquinas 
$ sudo apt update

# En ambas maquinas instala apache y nginx 
$ sudo apt install -y apache2 keepalived 
$ sudo apt install -y nginx keepalived 

# En la maquina 1 cre la pagina html que se llamara "server1" 
$ echo "server1" | sudo tee /var/www/html/html.index

# Asignale la ip virtual (VIP) a dicha pagina (maquina 1) 
$ sudo tee /etc/keepalived/keepalived.conf >/dev/null <<'EOF'
global_defs { router_id server1 }

vrrp_instance VI_100 {
state MASTER
interface ens33
virtual_router_id 100
priority 200
advert_int 1
virtual_ipaddress { 192.168.0.100/24 }
}

vrrp_instance VI_101 {
state BACKUP
interface ens33
virtual_router_id 101
priority 100
advert_int 1
virtual_ipaddress { 192.168.0.101/24 }
}
EOF
sudo systemctl restart keepalived


# En la maquina secundaria crea la pagina que dira "server2" (maquina 2) 
$ echo "server2" | sudo tee /var/www/html/index.html

sudo tee /etc/keepalived/keepalived.conf >/dev/null <<'EOF'
global_defs { router_id server2 }

vrrp_instance VI_100 {
state BACKUP
interface ens33
virtual_router_id 100
priority 100
advert_int 1
virtual_ipaddress { 192.168.0.100/24 }
}

vrrp_instance VI_101 {
state MASTER
interface ens33
virtual_router_id 101
priority 200
advert_int 1
virtual_ipaddress { 192.168.0.101/24 }
}
EOF
sudo systemctl restart keepalived

# VerificaciÃ³n VIPs
ip a show ens33 | egrep '192.168.0.100|192.168.0.101'

# Agrega contenido en la pagina server1 
$ echo "server1" | sudo tee /var/www/html/index.html
sudo systemctl reload apache2

# Agrega contenido en la pagina server2
sudo tee /etc/nginx/sites-available/default_server2.conf >/dev/null <<'EOF'
server { listen 80 default_server; server_name _; root /var/www/server2; index index.html; location / { try_files $uri $uri/ =404; } }
EOF
sudo ln -sfn /etc/nginx/sites-available/default_server2.conf /etc/nginx/sites-enabled/default_server2.conf
sudo rm -f /etc/nginx/sites-enabled/default.conf~ 2>/dev/null || true
sudo mkdir -p /var/www/server2
echo "server2" | sudo tee /var/www/server2/index.html
sudo nginx -t && sudo systemctl reload nginx

# Verificacion de contenido en la primera pagina 
$ curl -s http://192.168.0.100 # -> server1

O TAMBIEN:
$ xdg-open http://192.168.0.100

# Verificacion de contenido en la segunda pagina 
$curl -s http://192.168.0.101 # -> server2

O TAMBIEN:
$ xdg-open http://192.168.0.101

# Prueba failover (opcional)
$ sudo systemctl stop keepalived # en server1: .100 debe moverse a server2
ip a show ens33 | egrep '192.168.0.100|192.168.0.101'
